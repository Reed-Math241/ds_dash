---
title: "Pulling"
output: html_document
---

```{r}
library(tidyverse)
library(lubridate)
library(sf)
library(plotly)
library(leaflet)
```


```{r}
t <- read_csv("https://raw.githubusercontent.com/joshyam-k/scheduled-commit-action/master/data-raw/lime.csv")

t <- t %>% 
  mutate(last_updated = with_tz(last_updated, "America/Los_Angeles"))

st_write(map, "shiny_app/sf_boundary1.shp")


map <- st_read("/Users/joshuayamamoto/Downloads/SF Shoreline and Islands/geo_export_f07717d3-0581-4d32-ae60-c9b2f961271a.shp")

map <- st_crop(map, xmin = -122.54, xmax = -122.35, ymin = 37.7, ymax = 37.83)






```


```{r}
leaflet(options = leafletOptions(minZoom = 11, maxZoom = 14)) %>% 
  addProviderTiles(providers$MtbMap,
                   options = providerTileOptions(opacity = 0.35)) %>%
  addProviderTiles(providers$Stamen.TonerLines,
                   options = providerTileOptions(opacity = 0.35)) %>% 
  addProviderTiles(providers$Stamen.TonerLabels) %>% 
  addCircleMarkers(lng = ~lon, lat = ~lat,
                     data = t, radius = 1) 
```




# how to add or subtract time
```{r}
max <- max(t$last_updated)
min <- min(t$last_updated)
max <- with_tz(max, "America/Los_Angeles")

new_min <- max
min <- with_tz(min, "America/Los_Angeles")


week(max) <- week(max) - 2




```


```{r}
t %>% 
  count(last_updated) %>% 
  ggplot(aes(last_updated, n)) +
  geom_col() +
  theme_minimal()
```

```{r}
t %>% 
  count(last_updated) %>% 
  ggplot(aes(x = last_updated, y = n, fill = ifelse(last_updated == max(t$last_updated), "yes", "no"))) +
  geom_col()
```

```{r}
fluidRow(
                box(
                  solidHeader = T,
                  plotOutput("plot1"), width = 9),
                box(
                  solidHeader = T,
                  knobInput(
                    inputId = "Knob",
                    label = "Number of hours ago:",
                    thickness = 0.35,
                    value = 0,
                    min = 0,
                    max = 24,
                    displayPrevious = F,
                    lineCap = "round",
                    fgColor = "#576a7d",
                    bgColor = "#f2f4f5",
                    inputColor = "#8ca4d4",
                    pre = "-"
                  ), width = 3, height = 419
                )
              ),
              fluidRow(
                box(
                  SolidHeader = T,
                  plotOutput("plot2"), width = 9, height = 225
                ),
                box(
                  solidHeader = T,
                  radioGroupButtons(
                    inputId = "bins",
                    selected = "14",
                    label = "Number of bins", 
                    choices = c("10", "14", "18", "22"),
                    status = "primary",
                    size = "lg",
                    individual = T
                  ),
                  width = 3, height = 225
                )
              )
```

