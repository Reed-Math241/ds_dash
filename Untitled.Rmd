---
title: "Pulling"
output: html_document
---

```{r}
library(tidyverse)
library(lubridate)
library(sf)
library(plotly)
```


```{r}
t <- read_csv("https://raw.githubusercontent.com/joshyam-k/scheduled-commit-action/master/data-raw/lime.csv")

t <- t %>% 
  mutate(last_updated = with_tz(last_updated, "America/Los_Angeles"))

st_write(map, "shiny_app/sf_boundary1.shp")


map <- st_read("/Users/joshuayamamoto/Downloads/SF Shoreline and Islands/geo_export_f07717d3-0581-4d32-ae60-c9b2f961271a.shp")

map <- st_crop(map, xmin = -122.54, xmax = -122.35, ymin = 37.7, ymax = 37.83)



map %>% 
  ggplot() +
  geom_hex(data = t, aes(lon, lat), inherit.aes = F, bins = 18) +
  geom_sf(fill = NA, color = "grey50") +
  scale_fill_gradient(
    low = "white",
    high = "#60c957"
  ) +
  theme_void() +
  theme(
    legend.position = "left"
  ) + 
  labs(
    fill = "t"
  )

ggplotly(mapp)
```






# how to add or subtract time
```{r}
max <- max(t$last_updated)
min <- min(t$last_updated)
max <- with_tz(max, "America/Los_Angeles")

new_min <- max
min <- with_tz(min, "America/Los_Angeles")


week(max) <- week(max) - 2


range_checker <- function(df){
  
  max <- max(df$last_updated)
  min <- min(df$last_updated)
  new_min <- max
  day(new_min) <- day(new_min) - 1
  
  if (min > new_min){
    df
  } else {
    
    df %>% 
      filter(last_updated > new_min)
      
  }
}


```





